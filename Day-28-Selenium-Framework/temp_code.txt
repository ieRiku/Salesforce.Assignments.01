import org.openqa.selenium.By;
import org.openqa.selenium.WebDriver;
import org.openqa.selenium.chrome.ChromeDriver;
import java.io.BufferedReader;
import java.io.FileReader;
import java.io.IOException;

public class SalesforceLoginFromFile { // Enclosed the code within a public class

    public static void main(String[] args) { // Added a main method as this is a standalone script
        // Set the path to your ChromeDriver executable
        System.setProperty("webdriver.chrome.driver", "E:\\chromedriver.exe");

        // Use try-with-resources to ensure FileReader and BufferedReader are closed automatically
        // This is the most robust way to handle file resources.
        try (FileReader myFile = new FileReader("E:\\td.txt");
             BufferedReader br = new BufferedReader(myFile)) {

            String line;
            int lineCount = 0;
            int iteration = 0; // Corrected typo: 'iteation' to 'iteration'

            // Loop through each line in the text file
            while ((line = br.readLine()) != null) {
                lineCount++; // Increment line count for each line read

                // Assuming the first line of your td.txt file is a header and actual data starts from the second line.
                // If your file does not have a header, remove 'if (lineCount > 1)'.
                if (lineCount > 1) {
                    // Split the line by ", " to get username and password
                    // The '2' limits the split to at most 2 parts, useful if passwords might contain commas.
                    String[] inputData = line.split(", ", 2);

                    // Ensure that the line was successfully split into two parts (username and password)
                    if (inputData.length == 2) {
                        iteration++; // Increment iteration for each valid data entry processed

                        WebDriver driver = null; // Declare driver here to ensure a new instance per login attempt
                        try {
                            driver = new ChromeDriver(); // Initialize ChromeDriver
                            driver.manage().window().maximize(); // Maximize the browser window

                            // Navigate to the Salesforce login page
                            // Corrected URL from "salesforc.com" to "salesforce.com" (assuming it was a typo)
                            driver.get("http://login.salesforce.com");

                            // Find username and password fields by name and enter credentials
                            driver.findElement(By.name("username")).sendKeys(inputData[0]);
                            driver.findElement(By.name("password")).sendKeys(inputData[1]);

                            // Find and click the Login button by ID
                            // Make sure "Login" is the correct ID (case-sensitive)
                            driver.findElement(By.id("Login")).click();

                            // Get the current URL after login attempt
                            String url = driver.getCurrentUrl();
                            System.out.println("Iteration " + iteration + ": Logged in with username '" + inputData[0] + "'. Current URL: " + url);

                            // You can add assertions here to verify login success, e.g.:
                            // if (!url.contains("salesforce.com/home")) {
                            //     System.err.println("Login failed for user: " + inputData[0]);
                            // }

                            Thread.sleep(1000); // Optional: Add a small delay for observation
                        } catch (InterruptedException e) {
                            System.err.println("Thread interrupted during sleep: " + e.getMessage());
                            Thread.currentThread().interrupt(); // Re-interrupt the thread
                        } finally {
                            // Ensure the driver is closed after each login attempt, whether successful or not
                            if (driver != null) {
                                driver.quit(); // Use quit() to close all associated windows and terminate the WebDriver session
                            }
                        }
                    } else {
                        System.err.println("Skipping malformed line (expected 'username, password'): " + line);
                    }
                }
            }
        } catch (IOException e) {
            // Catch and print any I/O errors (e.g., file not found, unable to read)
            System.err.println("An I/O error occurred: " + e.getMessage());
            e.printStackTrace();
        } catch (Exception e) {
            // Catch any other unexpected exceptions during the process
            System.err.println("An unexpected error occurred: " + e.getMessage());
            e.printStackTrace();
        }
    }
}